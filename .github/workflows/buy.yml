name: buy
on:
    workflow_dispatch:
        inputs:
            amount:
                required: false
                description: 구매수
                default: "1"
    schedule:
        - cron: "30 4 * * 5" # kst, 1시반
jobs:
    buy:
        runs-on: ubuntu-latest
        permissions:
            contents: read
        steps:
            - uses: actions/checkout@v6
            - uses: pnpm/action-setup@v4
            - uses: actions/setup-node@v6
              with:
                  node-version: 22
                  cache: "pnpm"
                  cache-dependency-path: pnpm-lock.yaml
            - run: |
                  pnpm install --frozen-lockfile
                  pnpm exec puppeteer browsers install chrome
                  node buy.js id=${{ secrets.LOTTO_ID }} pw=${{ secrets.LOTTO_PW }} url=${{ secrets.LOTTO_SLACK_URL }} amount=${{ github.event.inputs.amount || '5'}}
            - if: failure()
              uses: actions/upload-artifact@v4
              with:
                  name: buy-login-debug-${{ github.run_id }}
                  path: .artifacts
                  if-no-files-found: ignore
